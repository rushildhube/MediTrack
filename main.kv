#:import utils kivy.utils
#:import hex kivy.utils.get_color_from_hex

ScreenManagement:
    HomePage:
    LoginScreen:
    SignUpScreen:
    UserDashboard:
    ProfileScreen:
    BloodTestScreen:
    NewRecordScreen:
    ShowRecordScreen:
    Share:

<HomePage>:
    name: 'home'
    canvas.before:
        Color:
            rgba: hex('#ebebd3')
        Rectangle:
            pos: self.pos
            size: self.size
    BoxLayout:
        orientation: 'vertical'
        spacing: 20
        padding: [20, 50, 20, 50]
        Image:
            source: 'logo.png'
            size_hint: (1, 0.5)
            keep_ratio: True
            allow_stretch: True
        Button:
            text: 'Login'
            background_normal: ''
            background_color: hex('#007AFF')
            color: 1, 1, 1, 1
            size_hint_y: None
            height: 50
            on_release: root.manager.current = 'login'
        Button:
            text: 'Sign Up'
            background_normal: ''
            background_color: hex('#007AFF')
            color: 1, 1, 1, 1
            size_hint_y: None
            height: 50
            on_release: root.manager.current = 'signup'


<LoginScreen>:
    name: 'login'
    canvas.before:
        Color:
            rgba: hex('#ebebd3')
        Rectangle:
            pos: self.pos
            size: self.size
    BoxLayout:
        orientation: 'vertical'
        spacing: 10
        padding: [10, 50, 10, 50]
        size_hint: None, None
        size: 300, 400
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
        Label:
            text: '[b]Login to MediTrack[/b]'
            markup: True
            font_size: '20sp'
            color: hex('#000000')
            size_hint_y: None
            height: 40
        TextInput:
            id: login_username
            hint_text: 'Username'
            multiline: False
            padding_y: (5, 5)
            size_hint_y: None
            height: 40
            background_color: 1, 1, 1, 0.3
        TextInput:
            id: login_password
            password: True
            hint_text: 'Password'
            multiline: False
            padding_y: (5, 5)
            size_hint_y: None
            height: 40
            background_color: 1, 1, 1, 0.3
        Label:
            id: login_label
            text: ''
            color: hex('#FF3B30')
        Button:
            text: 'Login'
            size_hint_y: None
            height: 50
            background_color: hex('#34C759')
            on_release: app.root.get_screen('login').login()
        Button:
            text: 'Sign Up'
            size_hint_y: None
            height: 50
            background_color: hex('#007AFF')
            on_release: root.manager.current = 'signup'

<SignUpScreen>:
    name: 'signup'
    canvas.before:
        Color:
            rgba: hex('#ebebd3')
        Rectangle:
            pos: self.pos
            size: self.size
    BoxLayout:
        orientation: 'vertical'
        spacing: 10
        padding: [10, 50, 10, 50]
        size_hint: None, None
        size: 300, 400
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
        Label:
            text: '[b]Sign Up for MediTrack[/b]'
            markup: True
            font_size: '20sp'
            color: hex('#000000')
            size_hint_y: None
            height: 40
        TextInput:
            id: signup_username
            hint_text: 'Choose a Username'
            multiline: False
            padding_y: (5, 5)
            size_hint_y: None
            height: 40
            background_color: 1, 1, 1, 0.3
        TextInput:
            id: signup_password
            password: True
            hint_text: 'Choose a Password'
            multiline: False
            padding_y: (5, 5)
            size_hint_y: None
            height: 40
            background_color: 1, 1, 1, 0.3
        Label:
            id: signup_label
            text: ''
            color: hex('#FF3B30')
        Button:
            text: 'Create Account'
            size_hint_y: None
            height: 50
            background_color: hex('#34C759')
            on_release: app.root.get_screen('signup').signup()

<UserDashboard>:
    name: 'userdashboard'
    canvas.before:
        Color:
            rgba: hex('#f9f7f0')
        Rectangle:
            pos: self.pos
            size: self.size
    BoxLayout:
        orientation: 'vertical'
        spacing: dp(20)
        padding: dp(20)
        size_hint_y: None
        height: root.height
        Button:
            text: 'Upload Medical Records'
            background_normal: ''
            background_color: hex('#eea1a1')
            color: 1, 1, 1, 1
            on_release: app.root.get_screen('userdashboard').select_and_upload_file()
        Button:
            text: 'Blood Test'
            background_normal: ''
            background_color: hex('#eea1a1')
            color: 1, 1, 1, 1
            on_release: root.manager.current = 'bloodtest'
        Button:
            text: 'Share'
            background_normal: ''
            background_color: hex('#eea1a1')
            color: 1, 1, 1, 1
            on_release: root.manager.current = 'share'
        Button:
            text: 'Edit Profile'
            background_normal: ''
            background_color: hex('#eea1a1')
            color: 1, 1, 1, 1
            on_release: root.manager.current = 'profile'


<ProfileScreen>:
    name: 'profile'
    canvas.before:
        Color:
            rgba: hex('#ebebd3')
        Rectangle:
            pos: self.pos
            size: self.size
    BoxLayout:
        orientation: 'vertical'
        spacing: 10
        ScrollView:
            do_scroll_x: False
            do_scroll_y: True
            GridLayout:
                cols: 1
                size_hint_y: None
                height: self.minimum_height
                padding: 10
                spacing: 10

                RestrictedTextInput:
                    id: profile_name
                    hint_text: 'Name'
                    multiline: False
                    size_hint_y: None
                    height: 40

                RestrictedTextInput:
                    id: profile_diagnosis
                    hint_text: 'Diagnosis'
                    multiline: False
                    size_hint_y: None
                    height: 40

                RestrictedTextInput:
                    id: profile_age
                    hint_text: 'Age'
                    multiline: False
                    size_hint_y: None
                    height: 40

                RestrictedTextInput:
                    id: profile_medical_history
                    hint_text: 'Medical History'
                    multiline: True
                    size_hint_y: None
                    height: 80

                RestrictedTextInput:
                    id: profile_gender
                    hint_text: 'Gender'
                    multiline: False
                    size_hint_y: None
                    height: 40

                RestrictedTextInput:
                    id: profile_medication
                    hint_text: 'Medication'
                    multiline: True
                    size_hint_y: None
                    height: 80


    BoxLayout:
        size_hint_y: None
        height: 50
        padding: 10
        spacing: 10

        Button:
            text: 'Home'
            background_color: 0, 0.5, 1, 1  # Blue background color
            on_release: root.manager.current = 'userdashboard'

        Button:
            text: 'update'
            background_color: 0, 0.7, 0.3, 1  # Green background color
            on_release: root.save_profile()

        Button:
            text: 'Back'
            background_color: 1, 0.5, 0, 1  # Orange background color
            on_release: root.manager.current = 'userdashboard'

<BloodTestScreen>:
    name: 'bloodtest'
    canvas.before:
        Color:
            rgba: hex('#ebebd3')
        Rectangle:
            pos: self.pos
            size: self.size
    BoxLayout:
        orientation: 'vertical'
        padding: dp(20)
        spacing: dp(20)

        ScrollView:
            GridLayout:
                cols: 1
                spacing: dp(10)
                size_hint_y: None
                height: self.minimum_height

                Button:
                    text: 'New Record'
                    size_hint_y: None
                    height: dp(48)
                    background_normal: ''
                    background_color: hex('#eea1a1')
                    color: 1, 1, 1, 1
                    on_release: root.manager.current = 'newrecord'

                Button:
                    text: 'Show Record'
                    size_hint_y: None
                    height: dp(48)
                    background_normal: ''
                    background_color: hex('#eea1a1')
                    color: 1, 1, 1, 1
                    on_release: root.manager.current = 'showrecord'


    BoxLayout:
        size_hint_y: None
        height: 50
        padding: 10
        spacing: 10

        Button:
            text: 'Home'
            background_color: 0, 0.5, 1, 1  # Blue background color
            on_release: root.manager.current = 'userdashboard'

        Button:
            text: 'Upload Document'
            background_color: 0, 0.7, 0.3, 1  # Green background color
            on_release: app.root.get_screen('bloodtest').call()

        Button:
            text: 'Back'
            background_color: 1, 0.5, 0, 1  # Orange background color
            on_release: root.manager.current = 'userdashboard'

<NewRecordScreen>:
    name: 'newrecord'
    canvas.before:
        Color:
            rgba: hex('#ebebd3')
        Rectangle:
            pos: self.pos
            size: self.size
    BoxLayout:
        orientation: 'vertical'
        spacing: 10
        padding: [10, 50, 10, 50]

        RestrictedTextInput:
            id: test_date
            input_restriction: 'numeric'
            hint_text: 'Test Date'
            multiline: False
            size_hint_y: None
            height: 40

        RestrictedTextInput:
            id: blood_group
            input_restriction: 'alpha'
            hint_text: 'Blood Group'
            multiline: False
            size_hint_y: None
            height: 40

        RestrictedTextInput:
            id: wbc_count
            input_restriction: 'numeric'
            hint_text: 'WBC Count'
            multiline: False
            size_hint_y: None
            height: 40

        RestrictedTextInput:
            id: platelet_count
            input_restriction: 'numeric'
            hint_text: 'Platelet Count'
            multiline: False
            size_hint_y: None
            height: 40

        RestrictedTextInput:
            id: hemoglobin
            input_restriction: 'numeric'
            hint_text: 'Hemoglobin'
            multiline: False
            size_hint_y: None
            height: 40

        Button:
            text: 'Save Record'
            size_hint_y: None
            height: 50
            on_release: app.root.get_screen('newrecord').save_new_record(test_date.text, blood_group.text, wbc_count.text, platelet_count.text, hemoglobin.text)
    BoxLayout:
        size_hint_y: None
        height: 50
        padding: 10
        spacing: 10

        Button:
            text: 'Home'
            on_release: root.manager.current = 'dashboard'

        Button:
            text: 'Back'
            on_release: root.manager.current = 'bloodtest'

<ShowRecordScreen>:
    name: 'showrecord'
    canvas.before:
        Color:
            rgba: hex('#ebebd3')
        Rectangle:
            pos: self.pos
            size: self.size
    BoxLayout:
        orientation: 'vertical'
        padding: [10, 50, 10, 50]

        ScrollView:
            Label:
                id: excel_data
                text: ''
                color: 0,0,0,1
                size_hint_y: None
                height: self.texture_size[1]

    BoxLayout:
        size_hint_y: None
        height: 50
        padding: 10
        spacing: 10

        Button:
            text: 'Home'
            background_color: 0, 0.5, 1, 1  # Blue background color
            on_release: root.manager.current = 'userdashboard'

        Button:
            text: 'Display'
            background_color: 0, 0.7, 0.3, 1  # Green background color
            on_release: on_release: app.root.get_screen('showrecord').open_excel('records.xlsx')

        Button:
            text: 'Back'
            background_color: 1, 0.5, 0, 1  # Orange background color
            on_release: root.manager.current = 'userdashboard'

<Share>:
    name: 'share'
    canvas.before:
        Color:
            rgba: hex('#ebebd3')
        Rectangle:
            pos: self.pos
            size: self.size
    BoxLayout:
        orientation: 'vertical'
        spacing: 20
        padding: [20, 50, 20, 50]
        Image:
            source: 'logo.png'
            size_hint: (1, 0.5)
            keep_ratio: True
            allow_stretch: True
        ScrollView:
            do_scroll_x: False
            do_scroll_y: False
            GridLayout:
                cols: 1
                size_hint_y: None
                height: self.minimum_height
                padding: 10
                spacing: 10

                RestrictedTextInput:
                    id: email
                    hint_text: 'example@email.com'
                    multiline: False
                    size_hint_y: None
                    height: 40



    BoxLayout:
        size_hint_y: None
        height: 50
        padding: 10
        spacing: 10

        Button:
            text: 'Home'
            background_color: 0, 0.5, 1, 1  # Blue background color
            on_release: root.manager.current = 'userdashboard'

        Button:
            text: 'Share'
            background_color: 0, 0.7, 0.3, 1  # Green background color
            on_release: app.root.get_screen('share').call(email.text)

        Button:
            text: 'Back'
            background_color: 1, 0.5, 0, 1  # Orange background color
            on_release: root.manager.current = 'userdashboard'